# InvestTrack - 个人投资策略追踪系统 (NAS Edition)

**InvestTrack** 是一个基于“策略驱动”和“月度快照”方法论的个人资产管理工具。

与传统的记账软件不同，它不关注每一笔琐碎的交易流水，而是关注**每个月月底的资产状态**以及**实际持仓与目标策略的偏差**。

本项目采用前后端分离架构，专为部署在家庭 NAS（如群晖、威联通）或个人服务器设计，数据存储于 SQLite 数据库中，安全可控，隐私无忧。

---

## ✨ 核心功能

1.  **📊 仪表盘 (Dashboard)**
    *   可视化展示资产分布、历史净值曲线、累计投入与盈亏。
    *   自动计算当前持仓与目标策略的偏离度。
    *   **区间分析**: 支持查看“今年以来(YTD)”或“近一年”的**区间盈利**，而非仅仅是历史总盈利。

2.  **⚖️ 策略管理 (Strategy IPS)**
    *   定义您的投资“宪法”。
    *   创建不同版本的投资组合策略（如：2024 激进版）。
    *   设置具体的资产配置目标比例（如：沪深300 40% + 纳斯达克 30%）。

3.  **🗃️ 资产库管理 (Asset Library)**
    *   统一管理所有投资标的（股票、基金、黄金、加密货币、定存等）。
    *   支持**时光机模式**：回溯查看历史上某个月底的具体持仓列表。

4.  **📸 月度快照 (Snapshots)**
    *   **核心逻辑**：每月只需记录一次资产状态。
    *   **统一流水制**：无论是买卖股票还是存取款，均通过“变动量”和“净投入”来记录，准确计算成本。
    *   **投资笔记**：支持 Markdown 格式记录每月的投资思考与复盘。

---

## 📖 使用手册 (User Manual)

### 1. 核心设计理念

InvestTrack 采用 **“月度快照 (Monthly Snapshot)”** 与 **“策略驱动 (Strategy Driven)”** 的核心方法论。

*   **策略驱动**: 投资不应是随机的，而应基于既定的资产配置比例（IPS）。系统会时刻计算您当前的实际持仓与目标策略的偏离度，辅助您进行动态平衡。
*   **关注存量**: 不同于记账软件记录每一笔“买早餐”、“发工资”的流水，InvestTrack 关注的是**月底时刻**您的资产负债表状态。

### 2. 核心数据逻辑

为了准确计算所有资产的“成本”与“盈亏”，本系统摒弃了单纯修改总数的快照逻辑，转而采用统一的**“流水累积制 (Unified Flow)”**。无论是买卖股票，还是银行存取款，我们都将其视为一笔“交易”。

#### 通用公式
*   **期末持有量** = `期初持有` + `本期变动 (Quantity Change)`
*   **期末总成本** = `期初成本` + `本期净投入 (Principal Change)`

#### A. 波动资产 (证券/基金/黄金)
这类资产既有份额变化，也有价格波动。
*   **记录方式**:
    *   **本月变动(份额)**：买入填正数，卖出填负数。
    *   **本月流水(本金)**：买入花了多少钱(正)，卖出拿回多少钱(负)。
    *   **当前单价**：月底收盘价。

#### B. 稳健资产 (银行理财/存款)
这类资产通常单价恒定为 1.00，系统通过份额变化来体现利息。
*   **记录方式**:
    *   **存入本金**：在“本月流水”填入金额（如 +10000），系统会自动同步增加持有份额。
    *   **获得利息**：仅修改“本月变动”增加金额（如 +50），保持“本月流水”为 0。这意味着你的钱变多了，但没有投入新本金 = **盈利**。

### 3. 数据库设计详解 (Database Schema)

虽然前端针对两类资产提供了不同的交互方式，但在后端数据库（SQLite）中，它们被**归一化**存储在同一张表中。这种设计确保了数据结构的简洁和统计的高效。

#### 核心表结构关系
*   **snapshots 表 (1)**: 代表“某个月的账本封面”。存储日期、当月总市值、当月投资笔记。
*   **positions 表 (N)**: 代表“账本里的每一行记录”。存储具体资产在当月的状态。

#### 统一映射逻辑
无论资产类型如何，都会映射到 `positions` 表的以下字段：

| 数据库字段 | 波动资产 (Type A) | 稳健资产 (Type B) | 逻辑说明 |
| :--- | :--- | :--- | :--- |
| **quantity** | **持仓股数** (如 1000) | **总金额** (如 50000) | 统一代表“持有量” |
| **price** | **市场单价** (如 280.5) | **1.00** (恒定为1) | 现金的单价永远是1 |
| **market_value** | `quantity * price` | `quantity * 1` | **统一市值 (核心统计指标)** |
| **added_principal**| **本月买入金额** | **本月存入本金** | 统一代表“本金投入(流水)” |
| **added_quantity** | **本月买入股数** | **本月存入金额 + 利息** | 统一代表“份额增量” |

---

## 🛠 技术栈

*   **前端 (Frontend)**: React 19, TypeScript, Vite, Tailwind CSS, Recharts
*   **后端 (Backend)**: Node.js, Express, SQLite3

---

## 🚀 开发指南 (Local Development)

### 1. 安装依赖
```bash
npm install
```

### 2. 启动后端服务
```bash
node server.js
```
*   服务启动在 `http://localhost:3001`，并自动创建 `invest_track.db`。

### 3. 启动前端
```bash
npm run dev
```

---

## ☁️ 部署指南 (NAS / Server Deployment)

1.  **构建前端**: `npm run build`
2.  **准备目录**: 将 `dist/` 文件夹, `server.js`, `package.json` 放入 NAS 文件夹。
3.  **安装依赖**: `npm install express sqlite3 cors uuid`
4.  **运行**: `node server.js` (或使用 PM2 托管)